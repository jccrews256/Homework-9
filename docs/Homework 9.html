<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Cass Crews">

<title>Homework 9</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d4be639c637f3db3c684c66cefad7e0c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 9</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Cass Crews </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The goal of this work is to practice fitting models and evaluating the predictive ability of those models within the <code>tidymodels</code> framework. For this practice, we will use bike share rental data from the Seoul bike share program. The goal will be to effectively predict daily bike share rentals.</p>
<p>Note that this file includes the work I completed for Homework 8.</p>
</section>
<section id="loading-packages" class="level1">
<h1>Loading Packages</h1>
<p>Before getting started, we need to load in some packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Loading packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyverse' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'purrr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'forcats' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lubridate' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   4.0.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.3.0 ──
✔ broom        1.0.10     ✔ rsample      1.3.1 
✔ dials        1.4.2      ✔ tune         2.0.1 
✔ infer        1.0.9      ✔ workflows    1.3.0 
✔ modeldata    1.5.1      ✔ workflowsets 1.1.1 
✔ parsnip      1.3.3      ✔ yardstick    1.3.2 
✔ recipes      1.3.1      </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'yardstick' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'kableExtra' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'

The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'glmnet' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'Matrix' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack

Loaded glmnet 4.1-8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(baguette)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'baguette' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ranger' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'vip' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'vip'

The following object is masked from 'package:utils':

    vi</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensuring we don't print in scientific notation</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>,<span class="at">pillar.sigfig =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-in-data" class="level1">
<h1>Reading in Data</h1>
<p>Now we will read in the Seoul bike share data. In the code chunk below, note that we must specify that the encoding is “latin1” in order to read in the data without error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>bike_share_data<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"https://www4.stat.ncsu.edu/~online/datasets/SeoulBikeData.csv"</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"latin1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8760 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Date, Seasons, Holiday, Functioning Day
dbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<section id="checking-the-data" class="level3">
<h3 class="anchored" data-anchor-id="checking-the-data">Checking the Data</h3>
<p>Before we model the data, we need to do some standard validation checks.</p>
<p>First, we will check whether any of the variables have missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Capturing number of missing values by variable</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 14
   Date `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`
  &lt;int&gt;               &lt;int&gt; &lt;int&gt;             &lt;int&gt;         &lt;int&gt;
1     0                   0     0                 0             0
# ℹ 9 more variables: `Wind speed (m/s)` &lt;int&gt;, `Visibility (10m)` &lt;int&gt;,
#   `Dew point temperature(°C)` &lt;int&gt;, `Solar Radiation (MJ/m2)` &lt;int&gt;,
#   `Rainfall(mm)` &lt;int&gt;, `Snowfall (cm)` &lt;int&gt;, Seasons &lt;int&gt;, Holiday &lt;int&gt;,
#   `Functioning Day` &lt;int&gt;</code></pre>
</div>
</div>
<p>Impressively, none of the variables have missing values. This is a great dataset!</p>
<p>Next, we will confirm that the variable/column types set by <code>read_csv</code> are logical.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking variable types</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bike_share_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [8,760 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ Date                     : chr [1:8760] "01/12/2017" "01/12/2017" "01/12/2017" "01/12/2017" ...
 $ Rented Bike Count        : num [1:8760] 254 204 173 107 78 100 181 460 930 490 ...
 $ Hour                     : num [1:8760] 0 1 2 3 4 5 6 7 8 9 ...
 $ Temperature(°C)          : num [1:8760] -5.2 -5.5 -6 -6.2 -6 -6.4 -6.6 -7.4 -7.6 -6.5 ...
 $ Humidity(%)              : num [1:8760] 37 38 39 40 36 37 35 38 37 27 ...
 $ Wind speed (m/s)         : num [1:8760] 2.2 0.8 1 0.9 2.3 1.5 1.3 0.9 1.1 0.5 ...
 $ Visibility (10m)         : num [1:8760] 2000 2000 2000 2000 2000 ...
 $ Dew point temperature(°C): num [1:8760] -17.6 -17.6 -17.7 -17.6 -18.6 -18.7 -19.5 -19.3 -19.8 -22.4 ...
 $ Solar Radiation (MJ/m2)  : num [1:8760] 0 0 0 0 0 0 0 0 0.01 0.23 ...
 $ Rainfall(mm)             : num [1:8760] 0 0 0 0 0 0 0 0 0 0 ...
 $ Snowfall (cm)            : num [1:8760] 0 0 0 0 0 0 0 0 0 0 ...
 $ Seasons                  : chr [1:8760] "Winter" "Winter" "Winter" "Winter" ...
 $ Holiday                  : chr [1:8760] "No Holiday" "No Holiday" "No Holiday" "No Holiday" ...
 $ Functioning Day          : chr [1:8760] "Yes" "Yes" "Yes" "Yes" ...
 - attr(*, "spec")=
  .. cols(
  ..   Date = col_character(),
  ..   `Rented Bike Count` = col_double(),
  ..   Hour = col_double(),
  ..   `Temperature(°C)` = col_double(),
  ..   `Humidity(%)` = col_double(),
  ..   `Wind speed (m/s)` = col_double(),
  ..   `Visibility (10m)` = col_double(),
  ..   `Dew point temperature(°C)` = col_double(),
  ..   `Solar Radiation (MJ/m2)` = col_double(),
  ..   `Rainfall(mm)` = col_double(),
  ..   `Snowfall (cm)` = col_double(),
  ..   Seasons = col_character(),
  ..   Holiday = col_character(),
  ..   `Functioning Day` = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
</div>
<p>Outside of <code>Date</code> being a character instead of a date, and <code>Seasons</code>,<code>Holiday</code>, and <code>Functioning Day</code> being character types instead of factors, things look good! We can address those issues in a bit.</p>
<p>A tricky variable is <code>Hour</code>, as it is “circular”; hour 23 of one day is only 60 minutes from hour 0 of the next day. We will go ahead and convert this to a factor to be safe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting Hour to a factor variable</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>bike_share_data<span class="ot">&lt;-</span>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hour =</span> <span class="fu">factor</span>(Hour))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As additional validity checks, we will explore the values of each variable. To do so, we will generate basic summary statistics for the numeric variables and list the distinct values of the categorical variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating basic summary statistics for the numeric variables</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),<span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 7
  variable                        mean  median          sd     IQR   min     max
  &lt;chr&gt;                          &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 Rented Bike Count        7.046021e+2  504.5  644.9975     874.25   0   3556   
2 Temperature(°C)          1.288292e+1   13.7   11.94483     19    -17.8   39.4 
3 Humidity(%)              5.822626e+1   57     20.36241     32      0     98   
4 Wind speed (m/s)         1.724909e+0    1.5    1.036300     1.4    0      7.4 
5 Visibility (10m)         1.436826e+3 1698    608.2987    1060     27   2000   
6 Dew point temperature(°… 4.073813e+0    5.1   13.06037     19.5  -30.6   27.2 
7 Solar Radiation (MJ/m2)  5.691107e-1    0.01   0.8687462    0.93   0      3.52
8 Rainfall(mm)             1.486872e-1    0      1.128193     0      0     35   
9 Snowfall (cm)            7.506849e-2    0      0.4367462    0      0      8.8 </code></pre>
</div>
</div>
<p>Looking at the summary statistics for the numeric variables, nothing seems particularly concerning. However, I admit that I am not very knowledgeable of the normal range for solar radiation.</p>
<p>For the categorical variables, we won’t worry about <code>Date</code>; we will check the range of this variable once we convert is to a date type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Listing unique values of the categorical and factor variables excluding Date</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Hour, Seasons, Holiday, <span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(unique)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Hour
 [1] 0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 20 21 22 23
Levels: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23

$Seasons
[1] "Winter" "Spring" "Summer" "Autumn"

$Holiday
[1] "No Holiday" "Holiday"   

$`Functioning Day`
[1] "Yes" "No" </code></pre>
</div>
</div>
<p>No concerning values here.</p>
<p>Onto <code>Date</code>. We need to make this a date type so that it is more easily used. We can use the <code>lubridate</code> package for that.</p>
<p>After making the conversion, we can confirm the conversion worked by looking at the structure and extracting the min and max dates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting Date to a date</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>bike_share_data<span class="ot">&lt;-</span>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">dmy</span>(Date))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirming change</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(bike_share_data<span class="sc">$</span>Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Date[1:8760], format: "2017-12-01" "2017-12-01" "2017-12-01" "2017-12-01" "2017-12-01" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting min and max</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min =</span> <span class="fu">min</span>(Date),<span class="at">max =</span> <span class="fu">max</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  min        max       
  &lt;date&gt;     &lt;date&gt;    
1 2017-12-01 2018-11-30</code></pre>
</div>
</div>
<p>Looking at the structure as well as the endpoints of the date range, everything looks good! It seems we have a year of data starting on December 12, 2017, and ending on November 30, 2018.</p>
<p>Let’s convert the remaining character types to factors. Given the current values are generally informative, we won’t worry about creating any new labels for the levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting character types to factors</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>bike_share_data<span class="ot">&lt;-</span>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character),factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we move on to exploring our data more deeply, let’s convert the names to ones that are more R-friendly and consistent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting to more friendly variable names</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>bike_share_data<span class="ot">&lt;-</span>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">date =</span> Date,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">rented_count =</span> <span class="st">`</span><span class="at">Rented Bike Count</span><span class="st">`</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> Hour,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">temperature =</span> <span class="st">`</span><span class="at">Temperature(°C)</span><span class="st">`</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">humidity =</span> <span class="st">`</span><span class="at">Humidity(%)</span><span class="st">`</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">wind_speed =</span> <span class="st">`</span><span class="at">Wind speed (m/s)</span><span class="st">`</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">visibility =</span> <span class="st">`</span><span class="at">Visibility (10m)</span><span class="st">`</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">dew_point =</span> <span class="st">`</span><span class="at">Dew point temperature(°C)</span><span class="st">`</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">radiation =</span> <span class="st">`</span><span class="at">Solar Radiation (MJ/m2)</span><span class="st">`</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">rainfall =</span> <span class="st">`</span><span class="at">Rainfall(mm)</span><span class="st">`</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">snowfall =</span> <span class="st">`</span><span class="at">Snowfall (cm)</span><span class="st">`</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">season =</span> Seasons,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">holiday =</span> Holiday,</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">functional =</span> <span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarizing-the-hourly-data" class="level3">
<h3 class="anchored" data-anchor-id="summarizing-the-hourly-data">Summarizing the Hourly Data</h3>
<p>We’ve already produced overall summary statistics for our numeric variables. In doing so, we saw that there were roughly 705 bikes rented each hour, on average. We also saw that there was a substantial amount of variation with the standard deviation being nearly as large as the mean (645 bikes).</p>
<p>Now, let’s generate the same summary statistics for our variable of interest (number of bikes rented) by levels of <code>season</code>, <code>holiday</code>, and <code>functional</code>.</p>
<p>To start, we will summarize rental counts across levels of the functioning indicator, as it may reflect the hours the program is and is not operational.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating summary statistics for bikes rented by functional</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(functional) <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_count,<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mean__rented_count<span class="sc">:</span>max__rented_count,<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
  functional variable         mean median       sd   IQR   min   max
  &lt;fct&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 No         rented_count   0           0   0          0     0     0
2 Yes        rented_count 729.1570    542 642.3512   870     2  3556</code></pre>
</div>
</div>
<p>Indeed, there are no rentals for the hours in which <code>functional</code> is “no”. Let’s subset to only observations where this indicator has a value of “yes”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting to only operating hours</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>bike_share_data<span class="ot">&lt;-</span>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(functional<span class="sc">==</span><span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>functional)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating summary statistics for bikes rented by season</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season) <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_count,<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mean__rented_count<span class="sc">:</span>max__rented_count,<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  season variable          mean median       sd    IQR   min   max
  &lt;fct&gt;  &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Autumn rented_count  924.1105  856   617.5479 844        2  3298
2 Spring rented_count  746.2542  599   618.6680 893        2  3251
3 Summer rented_count 1034.073   905.5 690.2448 915.75     9  3556
4 Winter rented_count  225.5412  203   150.3722 195        3   937</code></pre>
</div>
</div>
<p>Note that winter has much lower average hourly rentals. This makes sense as this is the coldest time of the year.</p>
<p>Now, let’s look at rental rates by the <code>holiday</code> indicator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating summary statistics for bikes rented by holiday indicator</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(holiday) <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_count,<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mean__rented_count<span class="sc">:</span>max__rented_count,<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
  holiday    variable         mean median       sd    IQR   min   max
  &lt;fct&gt;      &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Holiday    rented_count 529.1544    259 573.9323 694.25     3  2400
2 No Holiday rented_count 739.2850    561 644.0047 872        2  3556</code></pre>
</div>
</div>
<p>Interestingly, the average hourly rental count is lower on holidays. This may be because holidays are more likely to occur in colder seasons, or it may be because the bikes are commonly used to travel to and from work.</p>
<p>To investigate this, let’s look at rental counts by <code>season</code> AND <code>holiday</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating summary statistics for bikes rented by season and holiday indicator</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, holiday) <span class="sc">|&gt;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_count,<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mean__rented_count<span class="sc">:</span>max__rented_count,<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'season'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 9
# Groups:   season [4]
  season holiday    variable          mean median       sd    IQR   min   max
  &lt;fct&gt;  &lt;fct&gt;      &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Autumn Holiday    rented_count  948.1042  900   603.4026 973.25   105  2400
2 Autumn No Holiday rented_count  922.8593  852   618.4115 833        2  3298
3 Spring Holiday    rented_count  635.3056  366.5 608.9188 869.5     11  2082
4 Spring No Holiday rented_count  750.0800  605   618.7902 890.5      2  3251
5 Summer Holiday    rented_count 1022.146   925   564.3735 848.25   218  2163
6 Summer No Holiday rented_count 1034.338   904.5 692.8875 918        9  3556
7 Winter Holiday    rented_count  156.625   138   107.5129 150        3   671
8 Winter No Holiday rented_count  232.2647  212   152.2752 196.25     7   937</code></pre>
</div>
</div>
<p>It seems the average hourly rental count is lower on holidays in spring and winter. However, the opposite is true in the fall and the difference is negligible in the summer.</p>
<p>As a final step, let’s look at pairwise correlations for the numeric variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">|&gt;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption=</span><span class="st">"Pairwise Correlations for Numeric Variables (Hourly)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="at">column =</span> <span class="dv">1</span>,<span class="at">bold =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")

Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Pairwise Correlations for Numeric Variables (Hourly)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rented_count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">temperature</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">humidity</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_speed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">visibility</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dew_point</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">radiation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rainfall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">snowfall</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">rented_count</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.5627402</td>
<td style="text-align: right;">-0.2019727</td>
<td style="text-align: right;">0.1250219</td>
<td style="text-align: right;">0.2123228</td>
<td style="text-align: right;">0.4002628</td>
<td style="text-align: right;">0.2738616</td>
<td style="text-align: right;">-0.1286261</td>
<td style="text-align: right;">-0.1516108</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">temperature</td>
<td style="text-align: right;">0.5627402</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.1664252</td>
<td style="text-align: right;">-0.0384808</td>
<td style="text-align: right;">0.0282621</td>
<td style="text-align: right;">0.9144670</td>
<td style="text-align: right;">0.3548435</td>
<td style="text-align: right;">0.0521489</td>
<td style="text-align: right;">-0.2177458</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">humidity</td>
<td style="text-align: right;">-0.2019727</td>
<td style="text-align: right;">0.1664252</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.3373524</td>
<td style="text-align: right;">-0.5485418</td>
<td style="text-align: right;">0.5394024</td>
<td style="text-align: right;">-0.4572727</td>
<td style="text-align: right;">0.2369169</td>
<td style="text-align: right;">0.1101265</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">wind_speed</td>
<td style="text-align: right;">0.1250219</td>
<td style="text-align: right;">-0.0384808</td>
<td style="text-align: right;">-0.3373524</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.1804276</td>
<td style="text-align: right;">-0.1771701</td>
<td style="text-align: right;">0.3262219</td>
<td style="text-align: right;">-0.0249313</td>
<td style="text-align: right;">-0.0037893</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">visibility</td>
<td style="text-align: right;">0.2123228</td>
<td style="text-align: right;">0.0282621</td>
<td style="text-align: right;">-0.5485418</td>
<td style="text-align: right;">0.1804276</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.1825864</td>
<td style="text-align: right;">0.1530461</td>
<td style="text-align: right;">-0.1703518</td>
<td style="text-align: right;">-0.1228597</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">dew_point</td>
<td style="text-align: right;">0.4002628</td>
<td style="text-align: right;">0.9144670</td>
<td style="text-align: right;">0.5394024</td>
<td style="text-align: right;">-0.1771701</td>
<td style="text-align: right;">-0.1825864</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.0985250</td>
<td style="text-align: right;">0.1268125</td>
<td style="text-align: right;">-0.1497598</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">radiation</td>
<td style="text-align: right;">0.2738616</td>
<td style="text-align: right;">0.3548435</td>
<td style="text-align: right;">-0.4572727</td>
<td style="text-align: right;">0.3262219</td>
<td style="text-align: right;">0.1530461</td>
<td style="text-align: right;">0.0985250</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.0741573</td>
<td style="text-align: right;">-0.0733799</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">rainfall</td>
<td style="text-align: right;">-0.1286261</td>
<td style="text-align: right;">0.0521489</td>
<td style="text-align: right;">0.2369169</td>
<td style="text-align: right;">-0.0249313</td>
<td style="text-align: right;">-0.1703518</td>
<td style="text-align: right;">0.1268125</td>
<td style="text-align: right;">-0.0741573</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.0086041</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">snowfall</td>
<td style="text-align: right;">-0.1516108</td>
<td style="text-align: right;">-0.2177458</td>
<td style="text-align: right;">0.1101265</td>
<td style="text-align: right;">-0.0037893</td>
<td style="text-align: right;">-0.1228597</td>
<td style="text-align: right;">-0.1497598</td>
<td style="text-align: right;">-0.0733799</td>
<td style="text-align: right;">0.0086041</td>
<td style="text-align: right;">1.0000000</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Focusing on correlations with the response, it seems <code>temperature</code> and sunlight (proxied by <code>radiation</code>) have the strongest correlations with rental count. <code>humidity</code> has the weakest relationship with rental count, but there may still be a non-linear relationship or a linear relationship that only exists when we control for other factors correlated with <code>humidity</code> and <code>rented_count</code>.</p>
</section>
<section id="converting-to-daily-data" class="level3">
<h3 class="anchored" data-anchor-id="converting-to-daily-data">Converting to Daily Data</h3>
<p>To simplify our analysis, let’s convert our hourly data to daily. In many ways, this is more informative, as intra-day variations add an unnecessary layer of complexity.</p>
<p>To do so, we will sum hourly rental counts, snowfall, and rainfall. We will average everything else.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting data to daily</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>bike_share_data<span class="ot">&lt;-</span>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, season, holiday) <span class="sc">|&gt;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(rented_count, snowfall, rainfall),sum,<span class="at">.names =</span> <span class="st">"{.col}_day"</span>), <span class="co">#some variables to sums</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(temperature<span class="sc">:</span>radiation,mean,<span class="at">.names =</span> <span class="st">"{.col}_day"</span>)) <span class="sc">|&gt;</span> <span class="co">#others to means</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(date, season, holiday, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, season, holiday, <span class="fu">ends_with</span>(<span class="st">"_day"</span>)) <span class="sc">|&gt;</span> <span class="co">#removing original hourly numeric variables</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">str_remove</span>(.,<span class="st">"_day"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarizing-the-daily-data" class="level3">
<h3 class="anchored" data-anchor-id="summarizing-the-daily-data">Summarizing the Daily Data</h3>
<p>Now that we have daily data, let’s recreate the summary statistics we produced for the hourly data.</p>
<p>To start, let’s reproduce the overall summary statistics for our numeric variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating basic summary statistics for the numeric variables</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),<span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 7
  variable              mean       median           sd          IQR          min
  &lt;chr&gt;                &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
1 rented_count 17485.31      18563        9937.165      1.9318  e+4 977         
2 snowfall         1.862890      0           8.804413   0             0         
3 rainfall         3.575921      0          11.78987    5       e-1   0         
4 temperature     12.77584      13.7375     11.71840    1.92875 e+1 -14.7375    
5 humidity        58.16627      57.16667    14.86552    2.0125  e+1  22.25      
6 wind_speed       1.726148      1.658333    0.5972809  6.5     e-1   0.6625    
7 visibility    1434.014      1557.75      491.1561     7.8725  e+2 214.2917    
8 dew_point        3.954165      4.6125     12.99294    2.010833e+1 -27.75      
9 radiation        0.5677319     0.565       0.3161252  5.366667e-1   0.02916667
# ℹ 1 more variable: max &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This clearly demonstrates our transformations, as the previously hourly averages for <code>rented_count</code>, <code>snowfall</code>, and <code>rainfall</code> have now been effectively scaled up to reflect the 24-hour period.</p>
<p>Now to the arguably more interesting tables, let’s look at the bike rental counts by season.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating summary statistics for bikes rented by season</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_count,<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mean__rented_count<span class="sc">:</span>max__rented_count,<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  season variable          mean  median       sd      IQR   min   max
  &lt;fct&gt;  &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Autumn rented_count 22098.79  23350   6710.893 10733     1721 31809
2 Spring rented_count 17910.1   17590   8357.149 14361.75   977 31681
3 Summer rented_count 24817.76  25571.5 7297.344  9308.5   3231 36149
4 Winter rented_count  5412.989  5498   1808.340  2633.75  2014  9539</code></pre>
</div>
</div>
<p>We see the same pattern as we did for the hourly data, with summer and autumn having the highest daily average counts. One interesting note we did not discuss previously: the standard deviation, inner quartile range, and range all indicate that spring sees the greatest volatility in bike share activity across days. This is not particularly surprising as spring likely has both cold, snowy days and warm, sunny days.</p>
<p>Let’s look again at rental activity by the holiday indicator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating summary statistics for bikes rented by holiday indicator</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(holiday) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_count,<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mean__rented_count<span class="sc">:</span>max__rented_count,<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
  holiday    variable         mean  median        sd      IQR   min   max
  &lt;fct&gt;      &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Holiday    rented_count 12699.71  7184   10504.34  16576     2014 30498
2 No Holiday rented_count 17727.44 19104.5  9862.417 19167.75   977 36149</code></pre>
</div>
</div>
<p>We again see the intriguing factor that non-holiday days in our sample see greater rental activity, on average.</p>
<p>As we did previously, we will explore whether this relationship holds across seasons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generating summary statistics for bikes rented by season and holiday indicator</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(season, holiday) <span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_count,<span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"median"</span> <span class="ot">=</span> median,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"sd"</span> <span class="ot">=</span> sd,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"IQR"</span> <span class="ot">=</span> IQR,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"min"</span> <span class="ot">=</span> min,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"max"</span> <span class="ot">=</span> max),</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}__{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mean__rented_count<span class="sc">:</span>max__rented_count,<span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"variable"</span>),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"__"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'season'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 9
# Groups:   season [4]
  season holiday    variable         mean  median        sd      IQR   min   max
  &lt;fct&gt;  &lt;fct&gt;      &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Autumn Holiday    rented_cou… 22754.5   21705    5641.864  5740    17259 30349
2 Autumn No Holiday rented_cou… 22064.73  23472    6791.622 10734     1721 31809
3 Spring Holiday    rented_cou… 15247.33  13790   10917.20  10844     5132 26820
4 Spring No Holiday rented_cou… 18001.92  17730    8321.699 14223.5    977 31681
5 Summer Holiday    rented_cou… 24531.5   24531.5  8437.905  5966.5  18565 30498
6 Summer No Holiday rented_cou… 24824.12  25571.5  7324.345  9165     3231 36149
7 Winter Holiday    rented_cou…  3759      3453.5  1561.108  1060.25  2014  7184
8 Winter No Holiday rented_cou…  5574.354  5609    1756.674  2564     2487  9539</code></pre>
</div>
</div>
<p>We again see that non-holiday days see more activity, on average, than holiday days only in spring and winter.</p>
<p>Before we produce graphical summaries of the data, let’s reproduce the pairwise correlation table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>bike_share_data <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption=</span><span class="st">"Pairwise Correlations for Numeric Variables (Daily)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="at">column =</span> <span class="dv">1</span>,<span class="at">bold =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")

Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Pairwise Correlations for Numeric Variables (Daily)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rented_count</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">snowfall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rainfall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">temperature</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">humidity</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wind_speed</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">visibility</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dew_point</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">radiation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">rented_count</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.2652911</td>
<td style="text-align: right;">-0.2391091</td>
<td style="text-align: right;">0.7530767</td>
<td style="text-align: right;">0.0358870</td>
<td style="text-align: right;">-0.1928814</td>
<td style="text-align: right;">0.1659937</td>
<td style="text-align: right;">0.6504765</td>
<td style="text-align: right;">0.7358929</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">snowfall</td>
<td style="text-align: right;">-0.2652911</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.0231340</td>
<td style="text-align: right;">-0.2669637</td>
<td style="text-align: right;">0.0653919</td>
<td style="text-align: right;">0.0208816</td>
<td style="text-align: right;">-0.1018890</td>
<td style="text-align: right;">-0.2095529</td>
<td style="text-align: right;">-0.2334306</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">rainfall</td>
<td style="text-align: right;">-0.2391091</td>
<td style="text-align: right;">-0.0231340</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.1445173</td>
<td style="text-align: right;">0.5286426</td>
<td style="text-align: right;">-0.1016758</td>
<td style="text-align: right;">-0.2219939</td>
<td style="text-align: right;">0.2645662</td>
<td style="text-align: right;">-0.3227041</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">temperature</td>
<td style="text-align: right;">0.7530767</td>
<td style="text-align: right;">-0.2669637</td>
<td style="text-align: right;">0.1445173</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.4041675</td>
<td style="text-align: right;">-0.2607218</td>
<td style="text-align: right;">0.0023367</td>
<td style="text-align: right;">0.9627963</td>
<td style="text-align: right;">0.5502743</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">humidity</td>
<td style="text-align: right;">0.0358870</td>
<td style="text-align: right;">0.0653919</td>
<td style="text-align: right;">0.5286426</td>
<td style="text-align: right;">0.4041675</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.2342578</td>
<td style="text-align: right;">-0.5591773</td>
<td style="text-align: right;">0.6320473</td>
<td style="text-align: right;">-0.2744497</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">wind_speed</td>
<td style="text-align: right;">-0.1928814</td>
<td style="text-align: right;">0.0208816</td>
<td style="text-align: right;">-0.1016758</td>
<td style="text-align: right;">-0.2607218</td>
<td style="text-align: right;">-0.2342578</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.2060226</td>
<td style="text-align: right;">-0.2877032</td>
<td style="text-align: right;">0.0961263</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">visibility</td>
<td style="text-align: right;">0.1659937</td>
<td style="text-align: right;">-0.1018890</td>
<td style="text-align: right;">-0.2219939</td>
<td style="text-align: right;">0.0023367</td>
<td style="text-align: right;">-0.5591773</td>
<td style="text-align: right;">0.2060226</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.1535516</td>
<td style="text-align: right;">0.2713959</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">dew_point</td>
<td style="text-align: right;">0.6504765</td>
<td style="text-align: right;">-0.2095529</td>
<td style="text-align: right;">0.2645662</td>
<td style="text-align: right;">0.9627963</td>
<td style="text-align: right;">0.6320473</td>
<td style="text-align: right;">-0.2877032</td>
<td style="text-align: right;">-0.1535516</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.3831571</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">radiation</td>
<td style="text-align: right;">0.7358929</td>
<td style="text-align: right;">-0.2334306</td>
<td style="text-align: right;">-0.3227041</td>
<td style="text-align: right;">0.5502743</td>
<td style="text-align: right;">-0.2744497</td>
<td style="text-align: right;">0.0961263</td>
<td style="text-align: right;">0.2713959</td>
<td style="text-align: right;">0.3831571</td>
<td style="text-align: right;">1.0000000</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>There are no major differences between the daily and hourly correlations.</p>
<p>Let’s now look at scatterplots that visually compare our response to each numeric predictor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plot_list<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> <span class="fu">names</span>(bike_share_data)[<span class="dv">5</span><span class="sc">:</span><span class="dv">12</span>]) {</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  g<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>bike_share_data,<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">!!</span><span class="fu">sym</span>(v),<span class="at">y =</span> rented_count)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Rented Bikes"</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  plot_list<span class="ot">&lt;-</span><span class="fu">c</span>(plot_list,g) </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(plot_list) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Daily Bike Rentals vs. Each Numeric Predictor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Homework-9_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>One thing stands out that was reflected in the overall summary statistics table: the majority of days have no rain and/or no snow.</p>
<p>Overall, there are no clear signs of any non-linear relationships that would have been overlooked if we only considered correlations.</p>
<p>If we were focused on inference, the fanning of rented bikes counts as dew point and temperature increased would be of concern because of the constant variance assumption for linear regression models. Fortunately, we are focused on prediction.</p>
</section>
</section>
<section id="splitting-the-data" class="level1">
<h1>Splitting the Data</h1>
<p>To evaluate the predictive capabilities of the multiple linear regression models we build, we need to split the data into training and test sets. Let’s retain 75% of the data for training and stratify by <code>season</code> to ensure the seasonal breakdowns are similar across training and test sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting seed for reproducibility</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting the data into training and test sets </span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>bike_share_split<span class="ot">&lt;-</span><span class="fu">initial_split</span>(bike_share_data, <span class="at">strata =</span> season, <span class="at">prop =</span> <span class="fl">0.75</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing the structure of the split object</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>bike_share_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;263/90/353&gt;</code></pre>
</div>
</div>
<p>Note that in printing the structure we see that 263 of the 353 day-level observations are retained in the training set; the other 90 observations are places in the test set.</p>
<p>Let’s extract the training and test sets for use in our analysis. Let’s also split the training set into 10 folds so that we can identify the best model among candidate linear regression models using 10-fold cross validation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting seed for reproducibility </span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting training and test sets</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>bike_share_train<span class="ot">&lt;-</span><span class="fu">training</span>(bike_share_split)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>bike_share_test<span class="ot">&lt;-</span><span class="fu">testing</span>(bike_share_split)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Separating the training data into the 10 folds</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>folds<span class="ot">&lt;-</span><span class="fu">vfold_cv</span>(bike_share_train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing the structure of the folds object</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>folds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation 
# A tibble: 10 × 2
   splits           id    
   &lt;list&gt;           &lt;chr&gt; 
 1 &lt;split [236/27]&gt; Fold01
 2 &lt;split [236/27]&gt; Fold02
 3 &lt;split [236/27]&gt; Fold03
 4 &lt;split [237/26]&gt; Fold04
 5 &lt;split [237/26]&gt; Fold05
 6 &lt;split [237/26]&gt; Fold06
 7 &lt;split [237/26]&gt; Fold07
 8 &lt;split [237/26]&gt; Fold08
 9 &lt;split [237/26]&gt; Fold09
10 &lt;split [237/26]&gt; Fold10</code></pre>
</div>
</div>
<p>In printing <code>folds</code>, we see that we have segmented the training data into 10 folds.</p>
</section>
<section id="modeling-rental-counts-with-multiple-linear-regression-models" class="level1">
<h1>Modeling Rental Counts with Multiple Linear Regression Models</h1>
<p>Now we can build some models. The first model we will specify has the following characteristics:</p>
<ul>
<li>All variables in the dataset are used to predict <code>rented_count</code>
<ul>
<li>The one caveat is that we use a weekend indicator rather than <code>date</code> explicitly</li>
</ul></li>
<li>All numeric variables are normalized</li>
<li>Dummies are creates for the levels of the factor variables (<code>season</code>, <code>holiday</code>, and the new <code>weekend</code> indicator)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Constructing first recipe</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>bike_rec_1<span class="ot">&lt;-</span><span class="fu">recipe</span>(rented_count <span class="sc">~</span> ., <span class="at">data =</span> bike_share_train) <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Assigning date to ID role</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating intermediate day-of-week variable</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating weekend indicator</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">weekend =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>,<span class="st">"Sun"</span>),<span class="st">"yes"</span>,<span class="st">"no"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Removing intermediate variable</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(date_dow) <span class="sc">|&gt;</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Normalizing all numeric predictors</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating dummies for all factors</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(season, holiday, weekend)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing recipe variable list with roles</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>bike_rec_1 <span class="sc">|&gt;</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">training =</span> bike_share_train) <span class="sc">|&gt;</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 4
   variable           type      role      source  
   &lt;chr&gt;              &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
 1 date               &lt;chr [1]&gt; ID        original
 2 snowfall           &lt;chr [2]&gt; predictor original
 3 rainfall           &lt;chr [2]&gt; predictor original
 4 temperature        &lt;chr [2]&gt; predictor original
 5 humidity           &lt;chr [2]&gt; predictor original
 6 wind_speed         &lt;chr [2]&gt; predictor original
 7 visibility         &lt;chr [2]&gt; predictor original
 8 dew_point          &lt;chr [2]&gt; predictor original
 9 radiation          &lt;chr [2]&gt; predictor original
10 rented_count       &lt;chr [2]&gt; outcome   original
11 season_Spring      &lt;chr [2]&gt; predictor derived 
12 season_Summer      &lt;chr [2]&gt; predictor derived 
13 season_Winter      &lt;chr [2]&gt; predictor derived 
14 holiday_No.Holiday &lt;chr [2]&gt; predictor derived 
15 weekend_yes        &lt;chr [2]&gt; predictor derived </code></pre>
</div>
</div>
<p>In printing the summary of the prepped recipe, we can see that date now has the role “ID” rather than “predictor”. We can also see the indicators that were created.</p>
<p>Let’s specify a second model that includes all the previous characteristics, but also includes interactions for <code>season</code> and <code>holiday</code>, <code>season</code> and <code>temperature</code>, and <code>temperature</code> and <code>rainfall</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Constructing first recipe</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>bike_rec_2<span class="ot">&lt;-</span><span class="fu">recipe</span>(rented_count <span class="sc">~</span> ., <span class="at">data =</span> bike_share_train) <span class="sc">|&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Assigning date to ID role</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating intermediate day-of-week variable</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date, <span class="at">features=</span><span class="fu">c</span>(<span class="st">"dow"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating weekend indicator</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">weekend =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>,<span class="st">"Sun"</span>),<span class="st">"yes"</span>,<span class="st">"no"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Removing intermediate variable</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(date_dow) <span class="sc">|&gt;</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Normalizing all numeric predictors</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating dummies for all factors</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(season, holiday, weekend) <span class="sc">|&gt;</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding season-holiday interaction</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span>holiday_No.Holiday<span class="sc">*</span><span class="fu">starts_with</span>(<span class="st">"season"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding season-temp interaction </span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span>temperature<span class="sc">*</span><span class="fu">starts_with</span>(<span class="st">"season"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding temperature-rainfall interaction </span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span>temperature<span class="sc">*</span>rainfall)</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing recipe variable list with roles</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>bike_rec_2 <span class="sc">|&gt;</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">training =</span> bike_share_train) <span class="sc">|&gt;</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 4
   variable                           type      role      source  
   &lt;chr&gt;                              &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
 1 date                               &lt;chr [1]&gt; ID        original
 2 snowfall                           &lt;chr [2]&gt; predictor original
 3 rainfall                           &lt;chr [2]&gt; predictor original
 4 temperature                        &lt;chr [2]&gt; predictor original
 5 humidity                           &lt;chr [2]&gt; predictor original
 6 wind_speed                         &lt;chr [2]&gt; predictor original
 7 visibility                         &lt;chr [2]&gt; predictor original
 8 dew_point                          &lt;chr [2]&gt; predictor original
 9 radiation                          &lt;chr [2]&gt; predictor original
10 rented_count                       &lt;chr [2]&gt; outcome   original
11 season_Spring                      &lt;chr [2]&gt; predictor derived 
12 season_Summer                      &lt;chr [2]&gt; predictor derived 
13 season_Winter                      &lt;chr [2]&gt; predictor derived 
14 holiday_No.Holiday                 &lt;chr [2]&gt; predictor derived 
15 weekend_yes                        &lt;chr [2]&gt; predictor derived 
16 holiday_No.Holiday_x_season_Spring &lt;chr [2]&gt; predictor derived 
17 holiday_No.Holiday_x_season_Summer &lt;chr [2]&gt; predictor derived 
18 holiday_No.Holiday_x_season_Winter &lt;chr [2]&gt; predictor derived 
19 temperature_x_season_Spring        &lt;chr [2]&gt; predictor derived 
20 temperature_x_season_Summer        &lt;chr [2]&gt; predictor derived 
21 temperature_x_season_Winter        &lt;chr [2]&gt; predictor derived 
22 temperature_x_rainfall             &lt;chr [2]&gt; predictor derived </code></pre>
</div>
</div>
<p>When printing the summary of this prepped recipe, we see the interaction terms; the “x” in the interaction term names is a nice touch by the <code>tidyverse</code>.</p>
<p>Let’s specify a final model, which includes all of the characteristics as the second model and also includes quadratic terms for the numeric predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Constructing first recipe</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>bike_rec_3<span class="ot">&lt;-</span><span class="fu">recipe</span>(rented_count <span class="sc">~</span> ., <span class="at">data =</span> bike_share_train) <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Assigning date to ID role</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating intermediate day-of-week variable</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date, <span class="at">features=</span><span class="fu">c</span>(<span class="st">"dow"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating weekend indicator</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(<span class="at">weekend =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(date_dow <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Sat"</span>,<span class="st">"Sun"</span>),<span class="st">"yes"</span>,<span class="st">"no"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Removing intermediate variable</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(date_dow) <span class="sc">|&gt;</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Normalizing all numeric predictors</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding quadratic terms for numeric variables</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>(), <span class="at">degree =</span> <span class="dv">2</span>, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">raw =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Creating dummies for all factors</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(season, holiday, weekend) <span class="sc">|&gt;</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding season-holiday interaction</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span>holiday_No.Holiday<span class="sc">*</span><span class="fu">starts_with</span>(<span class="st">"season"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding season-temp interaction </span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span>temperature_poly_1<span class="sc">*</span><span class="fu">starts_with</span>(<span class="st">"season"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding temperature-rainfall interaction </span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span>temperature_poly_1<span class="sc">*</span>rainfall_poly_1)</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing recipe variable list with roles</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>bike_rec_3 <span class="sc">|&gt;</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">training =</span> bike_share_train) <span class="sc">|&gt;</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 4
   variable                             type      role      source  
   &lt;chr&gt;                                &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
 1 date                                 &lt;chr [1]&gt; ID        original
 2 rented_count                         &lt;chr [2]&gt; outcome   original
 3 snowfall_poly_1                      &lt;chr [2]&gt; predictor derived 
 4 snowfall_poly_2                      &lt;chr [2]&gt; predictor derived 
 5 rainfall_poly_1                      &lt;chr [2]&gt; predictor derived 
 6 rainfall_poly_2                      &lt;chr [2]&gt; predictor derived 
 7 temperature_poly_1                   &lt;chr [2]&gt; predictor derived 
 8 temperature_poly_2                   &lt;chr [2]&gt; predictor derived 
 9 humidity_poly_1                      &lt;chr [2]&gt; predictor derived 
10 humidity_poly_2                      &lt;chr [2]&gt; predictor derived 
11 wind_speed_poly_1                    &lt;chr [2]&gt; predictor derived 
12 wind_speed_poly_2                    &lt;chr [2]&gt; predictor derived 
13 visibility_poly_1                    &lt;chr [2]&gt; predictor derived 
14 visibility_poly_2                    &lt;chr [2]&gt; predictor derived 
15 dew_point_poly_1                     &lt;chr [2]&gt; predictor derived 
16 dew_point_poly_2                     &lt;chr [2]&gt; predictor derived 
17 radiation_poly_1                     &lt;chr [2]&gt; predictor derived 
18 radiation_poly_2                     &lt;chr [2]&gt; predictor derived 
19 season_Spring                        &lt;chr [2]&gt; predictor derived 
20 season_Summer                        &lt;chr [2]&gt; predictor derived 
21 season_Winter                        &lt;chr [2]&gt; predictor derived 
22 holiday_No.Holiday                   &lt;chr [2]&gt; predictor derived 
23 weekend_yes                          &lt;chr [2]&gt; predictor derived 
24 holiday_No.Holiday_x_season_Spring   &lt;chr [2]&gt; predictor derived 
25 holiday_No.Holiday_x_season_Summer   &lt;chr [2]&gt; predictor derived 
26 holiday_No.Holiday_x_season_Winter   &lt;chr [2]&gt; predictor derived 
27 temperature_poly_1_x_season_Spring   &lt;chr [2]&gt; predictor derived 
28 temperature_poly_1_x_season_Summer   &lt;chr [2]&gt; predictor derived 
29 temperature_poly_1_x_season_Winter   &lt;chr [2]&gt; predictor derived 
30 temperature_poly_1_x_rainfall_poly_1 &lt;chr [2]&gt; predictor derived </code></pre>
</div>
</div>
<p>We now have quadratic terms; note that the original numeric variables now have a “_poly_1” suffix to explicitly indicate they are still linear terms.</p>
<p>Our next step is to specify the type of model we want to fit, which is the linear regression model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying an ordinary least squares model</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>lm_model<span class="ot">&lt;-</span><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is finally time to fit some models and see how well they predict! The code below fits each of the three models we have specified above for each of the 10 “training” sets and collects their cross-validated prediction error metrics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting first model to each "training" set and testing for each fold </span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>bike_fit_1<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model) <span class="sc">|&gt;</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(folds)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting second model to each "training" set and testing for each fold </span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>bike_fit_2<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_2) <span class="sc">|&gt;</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model) <span class="sc">|&gt;</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(folds)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting third model to each "training" set and testing for each fold </span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>bike_fit_3<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_3) <span class="sc">|&gt;</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model) <span class="sc">|&gt;</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(folds)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Capturing fit metrics</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(bike_fit_1 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()),</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>      bike_fit_2 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()),</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>      bike_fit_3 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  model .metric .estimator         mean     n      std_err .config        
  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt; &lt;chr&gt;          
1     1 rmse    standard   4332.653        10  85.44616    pre0_mod0_post0
2     1 rsq     standard      0.8179826    10   0.01132838 pre0_mod0_post0
3     2 rmse    standard   3122.705        10 264.9047     pre0_mod0_post0
4     2 rsq     standard      0.9023865    10   0.01767856 pre0_mod0_post0
5     3 rmse    standard   3069.269        10 280.0173     pre0_mod0_post0
6     3 rsq     standard      0.9042805    10   0.01850216 pre0_mod0_post0</code></pre>
</div>
</div>
<p>Based on the cross-validated “test” root mean squared error (RMSE), the third linear regression model predicts the number of rented bikes best.</p>
<p>Now that we’ve identified the best model, let’s fit the model to the entire training set and obtain a final estimate of the out-of-sample RMSE using the original test set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting model to full training set and testing on full test set</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>final_fit<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_3) <span class="sc">|&gt;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_model) <span class="sc">|&gt;</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(bike_share_split, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting predictive performance for test set</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>final_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard    2963.439 pre0_mod0_post0
2 mae     standard    2181.411 pre0_mod0_post0</code></pre>
</div>
</div>
<p>As we would expect, the test RMSE is similar to that of the cross-validated RMSE we previously obtained for this model. In fact, the RMSE is slightly lower here, which could be explained by the fact that we used the full training set to train this model or simply by randomness.</p>
<p>As a final step, let’s extract a summary of the model fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting fit summary</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>final_fit <span class="sc">|&gt;</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")

Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 45%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">18209.37765</td>
<td style="text-align: right;">1508.76688</td>
<td style="text-align: right;">12.0690465</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">snowfall_poly_1</td>
<td style="text-align: right;">-117.68556</td>
<td style="text-align: right;">618.59272</td>
<td style="text-align: right;">-0.1902472</td>
<td style="text-align: right;">0.8492803</td>
</tr>
<tr class="odd">
<td style="text-align: left;">snowfall_poly_2</td>
<td style="text-align: right;">-21.61766</td>
<td style="text-align: right;">96.65746</td>
<td style="text-align: right;">-0.2236522</td>
<td style="text-align: right;">0.8232230</td>
</tr>
<tr class="even">
<td style="text-align: left;">rainfall_poly_1</td>
<td style="text-align: right;">-2395.91686</td>
<td style="text-align: right;">553.78090</td>
<td style="text-align: right;">-4.3264708</td>
<td style="text-align: right;">0.0000225</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rainfall_poly_2</td>
<td style="text-align: right;">190.90294</td>
<td style="text-align: right;">79.76025</td>
<td style="text-align: right;">2.3934597</td>
<td style="text-align: right;">0.0174793</td>
</tr>
<tr class="even">
<td style="text-align: left;">temperature_poly_1</td>
<td style="text-align: right;">1785.73905</td>
<td style="text-align: right;">4041.27237</td>
<td style="text-align: right;">0.4418755</td>
<td style="text-align: right;">0.6589874</td>
</tr>
<tr class="odd">
<td style="text-align: left;">temperature_poly_2</td>
<td style="text-align: right;">-1133.56024</td>
<td style="text-align: right;">1104.11783</td>
<td style="text-align: right;">-1.0266660</td>
<td style="text-align: right;">0.3056379</td>
</tr>
<tr class="even">
<td style="text-align: left;">humidity_poly_1</td>
<td style="text-align: right;">-1564.62701</td>
<td style="text-align: right;">1448.20597</td>
<td style="text-align: right;">-1.0803898</td>
<td style="text-align: right;">0.2810809</td>
</tr>
<tr class="odd">
<td style="text-align: left;">humidity_poly_2</td>
<td style="text-align: right;">-292.73851</td>
<td style="text-align: right;">300.46992</td>
<td style="text-align: right;">-0.9742689</td>
<td style="text-align: right;">0.3309291</td>
</tr>
<tr class="even">
<td style="text-align: left;">wind_speed_poly_1</td>
<td style="text-align: right;">-621.07193</td>
<td style="text-align: right;">259.94867</td>
<td style="text-align: right;">-2.3892099</td>
<td style="text-align: right;">0.0176778</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wind_speed_poly_2</td>
<td style="text-align: right;">165.06296</td>
<td style="text-align: right;">127.65542</td>
<td style="text-align: right;">1.2930353</td>
<td style="text-align: right;">0.1972740</td>
</tr>
<tr class="even">
<td style="text-align: left;">visibility_poly_1</td>
<td style="text-align: right;">334.28976</td>
<td style="text-align: right;">303.56435</td>
<td style="text-align: right;">1.1012155</td>
<td style="text-align: right;">0.2719343</td>
</tr>
<tr class="odd">
<td style="text-align: left;">visibility_poly_2</td>
<td style="text-align: right;">-120.67233</td>
<td style="text-align: right;">214.16845</td>
<td style="text-align: right;">-0.5634458</td>
<td style="text-align: right;">0.5736709</td>
</tr>
<tr class="even">
<td style="text-align: left;">dew_point_poly_1</td>
<td style="text-align: right;">4261.53746</td>
<td style="text-align: right;">4648.35411</td>
<td style="text-align: right;">0.9167842</td>
<td style="text-align: right;">0.3601996</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dew_point_poly_2</td>
<td style="text-align: right;">-313.49257</td>
<td style="text-align: right;">729.94508</td>
<td style="text-align: right;">-0.4294742</td>
<td style="text-align: right;">0.6679733</td>
</tr>
<tr class="even">
<td style="text-align: left;">radiation_poly_1</td>
<td style="text-align: right;">2837.25189</td>
<td style="text-align: right;">382.74822</td>
<td style="text-align: right;">7.4128416</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">radiation_poly_2</td>
<td style="text-align: right;">-629.22217</td>
<td style="text-align: right;">234.85741</td>
<td style="text-align: right;">-2.6791668</td>
<td style="text-align: right;">0.0079045</td>
</tr>
<tr class="even">
<td style="text-align: left;">season_Spring</td>
<td style="text-align: right;">-2633.38731</td>
<td style="text-align: right;">2599.25387</td>
<td style="text-align: right;">-1.0131320</td>
<td style="text-align: right;">0.3120435</td>
</tr>
<tr class="odd">
<td style="text-align: left;">season_Summer</td>
<td style="text-align: right;">18967.91348</td>
<td style="text-align: right;">3170.71942</td>
<td style="text-align: right;">5.9822113</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">season_Winter</td>
<td style="text-align: right;">-7288.67111</td>
<td style="text-align: right;">2815.88995</td>
<td style="text-align: right;">-2.5884077</td>
<td style="text-align: right;">0.0102457</td>
</tr>
<tr class="odd">
<td style="text-align: left;">holiday_No.Holiday</td>
<td style="text-align: right;">5549.79451</td>
<td style="text-align: right;">1497.30154</td>
<td style="text-align: right;">3.7065310</td>
<td style="text-align: right;">0.0002623</td>
</tr>
<tr class="even">
<td style="text-align: left;">weekend_yes</td>
<td style="text-align: right;">-2492.73551</td>
<td style="text-align: right;">397.78252</td>
<td style="text-align: right;">-6.2665789</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">holiday_No.Holiday_x_season_Spring</td>
<td style="text-align: right;">-1366.74899</td>
<td style="text-align: right;">2662.05569</td>
<td style="text-align: right;">-0.5134186</td>
<td style="text-align: right;">0.6081429</td>
</tr>
<tr class="even">
<td style="text-align: left;">holiday_No.Holiday_x_season_Summer</td>
<td style="text-align: right;">-1661.95577</td>
<td style="text-align: right;">2502.46204</td>
<td style="text-align: right;">-0.6641283</td>
<td style="text-align: right;">0.5072621</td>
</tr>
<tr class="odd">
<td style="text-align: left;">holiday_No.Holiday_x_season_Winter</td>
<td style="text-align: right;">-3848.82785</td>
<td style="text-align: right;">1900.37832</td>
<td style="text-align: right;">-2.0252956</td>
<td style="text-align: right;">0.0439724</td>
</tr>
<tr class="even">
<td style="text-align: left;">temperature_poly_1_x_season_Spring</td>
<td style="text-align: right;">5895.06124</td>
<td style="text-align: right;">1075.17730</td>
<td style="text-align: right;">5.4828736</td>
<td style="text-align: right;">0.0000001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">temperature_poly_1_x_season_Summer</td>
<td style="text-align: right;">-16875.80766</td>
<td style="text-align: right;">2431.62763</td>
<td style="text-align: right;">-6.9401283</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">temperature_poly_1_x_season_Winter</td>
<td style="text-align: right;">-5216.36619</td>
<td style="text-align: right;">2903.64863</td>
<td style="text-align: right;">-1.7964867</td>
<td style="text-align: right;">0.0737069</td>
</tr>
<tr class="odd">
<td style="text-align: left;">temperature_poly_1_x_rainfall_poly_1</td>
<td style="text-align: right;">-1679.91534</td>
<td style="text-align: right;">445.97450</td>
<td style="text-align: right;">-3.7668417</td>
<td style="text-align: right;">0.0002092</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>As we have not fully evaluated all of the assumptions underlying the p-values, we must be cautious in drawing any inferential conclusions for any of the coefficients. Additionally, the complex non-linear relationships modeled here make interpretation difficult. Acknowledging these limitations, there are still interesting relationships revealed by the coefficients and their p-values. For example, the effect of increasing temperature varies substantially by season, as we see that an increase in temperatures has a uniquely large negative impact on rental activity in the summer. This makes sense, as the average temperature in summer will already be warm and increases of a few degrees Celsius (or a few standard deviations in the model) could correspond to an uncomfortably hot day.</p>
<p>Additionally, higher levels of radiation (more sunny day) generally correspond to more rental activity, but there are diminishing returns to increased radiation reflected in the negative quadratic term.</p>
</section>
<section id="evaluating-additional-models" class="level1">
<h1>Evaluating Additional Models</h1>
<p>Let’s explore the potential of the LASSO model, regression tree model, bagged tree model, and random forest model to predict daily bike rentals.</p>
<p>To do so, we will compare predictive performance using the same predictors as above, but not including any interactions or quadratic terms; these terms are not necessary for the tree-based models due to their more flexible nature.</p>
<section id="lasso-model" class="level3">
<h3 class="anchored" data-anchor-id="lasso-model">LASSO Model</h3>
<p>We will start by tuning a LASSO model. Note that we can use the first recipe above and simply add a new model/engine when tuning. Let’s specify the new model/engine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying a LASSO model with the penalty parameter tuned</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>lasso_model<span class="ot">&lt;-</span><span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>, <span class="at">standardize =</span> <span class="cn">FALSE</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying workflow</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>lasso_wkf<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s use the same 10 folds as above to determine the “best” value of the penalty parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting LASSO model for each of 100 penalty values</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>lasso_fit<span class="ot">&lt;-</span>lasso_wkf <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">2</span>)), <span class="at">levels =</span> <span class="dv">100</span>),</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The chunk below extracts cross-validated RMSE values for each lambda/penalty value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting fit metrics</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 7
        penalty .metric .estimator     mean     n  std_err .config          
          &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;            
 1 1       e-10 rmse    standard   4326.752    10 86.37435 pre0_mod001_post0
 2 1.321941e-10 rmse    standard   4326.752    10 86.37435 pre0_mod002_post0
 3 1.747528e-10 rmse    standard   4326.752    10 86.37435 pre0_mod003_post0
 4 2.310130e-10 rmse    standard   4326.752    10 86.37435 pre0_mod004_post0
 5 3.053856e-10 rmse    standard   4326.752    10 86.37435 pre0_mod005_post0
 6 4.037017e-10 rmse    standard   4326.752    10 86.37435 pre0_mod006_post0
 7 5.336699e-10 rmse    standard   4326.752    10 86.37435 pre0_mod007_post0
 8 7.054802e-10 rmse    standard   4326.752    10 86.37435 pre0_mod008_post0
 9 9.326033e-10 rmse    standard   4326.752    10 86.37435 pre0_mod009_post0
10 1.232847e- 9 rmse    standard   4326.752    10 86.37435 pre0_mod010_post0
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Note that the RMSE values are constant until the penalty is above 3.51. This reflects an issue with the way <code>tidymodels</code> calls <code>glmnet()</code>. In particular, <code>tidymodels</code> allows <code>glmnet()</code> to specify its own sequence of penalty values and then interpolates predictions based on those penalty values to obtain predictions for the penalty values we specify. In this case, the lowest value <code>glmnet()</code> tries is a penalty values around 3.51.</p>
<p>The code below captures the value of penalty that corresponds to the most conservative model with the best RMSE (penalty=3.51).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Capturing best LASSO model (least complex "best" model)</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>lasso_best_params<span class="ot">&lt;-</span><span class="fu">show_best</span>(lasso_fit, <span class="at">metric =</span> <span class="st">"rmse"</span>, <span class="at">n =</span> <span class="cn">Inf</span>) <span class="sc">|&gt;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean<span class="sc">==</span><span class="fu">min</span>(mean)) <span class="sc">|&gt;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(penalty) <span class="sc">|&gt;</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(penalty)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing hyperparameter value</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>lasso_best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
   penalty
     &lt;dbl&gt;
1 3.511192</code></pre>
</div>
</div>
<p>We now have the information we need to evaluate our tuned LASSO model on the test set.</p>
</section>
<section id="regression-tree" class="level3">
<h3 class="anchored" data-anchor-id="regression-tree">Regression Tree</h3>
<p>Now let’s tune a regression tree model to see how well it performs. As we did for the LASSO model, we will start by specifying the model and engine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying model and engine for regression tree</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>tree_model<span class="ot">&lt;-</span><span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">5</span>,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating regression tree workflow</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>tree_wkf<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tree_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are using cross-validation to tune the tree depth and cost complexity hyperparameters, and we are specifying that no endpoint of the tree can have fewer than 5 observations.</p>
<p>Let’s fit the model across a grid of tree depth and cost complexity values to see which has the best fit characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting regression tree model across grid of depth and complexity values</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>tree_fit<span class="ot">&lt;-</span>tree_wkf <span class="sc">|&gt;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">tree_depth</span>(), <span class="fu">cost_complexity</span>(), <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>)),</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we’ve fit the <span class="math inline">\(10x10=100\)</span> regression tree models, let’s see which has the lowest RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sorting models by RMSE</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>tree_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator     mean     n  std_err .config
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;  
 1    0.0001                5 rmse    standard   4092.537    10 162.6993 pre0_m…
 2    0.0000000001          5 rmse    standard   4093.023    10 162.6976 pre0_m…
 3    0.000000001           5 rmse    standard   4093.023    10 162.6976 pre0_m…
 4    0.00000001            5 rmse    standard   4093.023    10 162.6976 pre0_m…
 5    0.0000001             5 rmse    standard   4093.023    10 162.6976 pre0_m…
 6    0.000001              5 rmse    standard   4093.023    10 162.6976 pre0_m…
 7    0.00001               5 rmse    standard   4093.023    10 162.6976 pre0_m…
 8    0.0001                7 rmse    standard   4115.322    10 212.5100 pre0_m…
 9    0.00001               7 rmse    standard   4121.130    10 213.6370 pre0_m…
10    0.0000000001          7 rmse    standard   4121.772    10 213.7138 pre0_m…
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Let’s capture the model with the lowest RMSE to test against the best models for the other families.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Capturing best tree model</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>tree_best_params<span class="ot">&lt;-</span><span class="fu">select_best</span>(tree_fit, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing hyperparameter values</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>tree_best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  cost_complexity tree_depth .config          
            &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;            
1          0.0001          5 pre0_mod064_post0</code></pre>
</div>
</div>
<p>Our best model has a tree depth of 5 and cost complexity of 0.0001.</p>
</section>
<section id="bagged-tree" class="level3">
<h3 class="anchored" data-anchor-id="bagged-tree">Bagged Tree</h3>
<p>Onto the bagged tree. Let’s specify our model and engine, indicating that we will again tune tree depth and cost complexity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying model and engine for bagged tree</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>bag_model<span class="ot">&lt;-</span><span class="fu">bag_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">5</span>,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating bagged tree workflow</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>bag_wkf<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(bag_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s fit our models to each set of “training” and “testing” data corresponding to each fold.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting seed for reproducibility when rerunning chunk</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting bagged tree model across grid of depth and complexity values</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>bag_fit<span class="ot">&lt;-</span>bag_wkf <span class="sc">|&gt;</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">tree_depth</span>(), <span class="fu">cost_complexity</span>(), <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">10</span>)),</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have fit the models, let’s see which has the best cross-validated RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sorting models by RMSE</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>bag_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator     mean     n  std_err .config
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;  
 1    0.00000001           13 rmse    standard   2903.273    10 123.0814 pre0_m…
 2    0.0000000001         10 rmse    standard   2905.642    10 111.4533 pre0_m…
 3    0.0000001            11 rmse    standard   2911.194    10 149.7095 pre0_m…
 4    0.00001               7 rmse    standard   2915.458    10 151.7954 pre0_m…
 5    0.000000001          10 rmse    standard   2916.825    10 142.2611 pre0_m…
 6    0.00000001            7 rmse    standard   2964.744    10 151.6287 pre0_m…
 7    0.0000000001          8 rmse    standard   2968.131    10 151.2367 pre0_m…
 8    0.0001               13 rmse    standard   2982.908    10 181.7075 pre0_m…
 9    0.0001                8 rmse    standard   2985.039    10 141.9807 pre0_m…
10    0.000000001           7 rmse    standard   2985.552    10 177.6839 pre0_m…
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Wow, this highly flexible model seems to be surfacing non-linear relationships between our response and predictors, as we now have a much lower cross-validated RMSE. Let’s capture the hyperparameters corresponding to the best fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Capturing best bagged tree model</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>bag_best_params<span class="ot">&lt;-</span><span class="fu">select_best</span>(bag_fit, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing hyperparameter values</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>bag_best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  cost_complexity tree_depth .config          
            &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;            
1      0.00000001         13 pre0_mod029_post0</code></pre>
</div>
</div>
<p>Our “best” combination of hyperparameters is a tree depth of 11 and cost complexity of 0.00001.</p>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">Random Forest</h3>
<p>Let’s tune our final model class: the random forest. As we did for the other models, we need to specify the model and engine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying model and engine for random forest</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>rf_model<span class="ot">&lt;-</span><span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">5</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trees =</span> <span class="dv">2000</span>) <span class="sc">|&gt;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">|&gt;</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating random forest workflow</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>rf_wkf<span class="ot">&lt;-</span><span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bike_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we are holding the number of trees in each forest and the number of observations per endpoint constant, while we are tuning the number of predictors we are considering at each split (<code>mtry</code>).</p>
<p>Let’s use cross-validation to identify the “best” value of <code>mtry</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting seed for reproducibility when rerunning chunk</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting random forest model across values of mtry</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>rf_fit<span class="ot">&lt;-</span>rf_wkf <span class="sc">|&gt;</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">mtry</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">13</span>)), <span class="at">levels =</span> <span class="dv">13</span>),</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We print the cross-validated RMSE values for each value of <code>mtry</code> below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sorting models by RMSE</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 7
    mtry .metric .estimator     mean     n  std_err .config         
   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;           
 1    13 rmse    standard   2832.662    10 135.1595 pre0_mod13_post0
 2    12 rmse    standard   2840.388    10 135.2537 pre0_mod12_post0
 3    11 rmse    standard   2851.000    10 140.4613 pre0_mod11_post0
 4    10 rmse    standard   2858.172    10 144.8538 pre0_mod10_post0
 5     9 rmse    standard   2883.635    10 144.8365 pre0_mod09_post0
 6     8 rmse    standard   2905.989    10 149.2997 pre0_mod08_post0
 7     7 rmse    standard   2936.812    10 155.2607 pre0_mod07_post0
 8     6 rmse    standard   2982.730    10 159.1785 pre0_mod06_post0
 9     5 rmse    standard   3015.448    10 166.4954 pre0_mod05_post0
10     4 rmse    standard   3088.323    10 169.9006 pre0_mod04_post0
11     3 rmse    standard   3193.385    10 183.3893 pre0_mod03_post0
12     2 rmse    standard   3520.632    10 180.5856 pre0_mod02_post0
13     1 rmse    standard   4866.414    10 169.4948 pre0_mod01_post0</code></pre>
</div>
</div>
<p>The random forest also posts relatively low RMSE values for the top models. Let’s extract the best-performing value of <code>mtry</code> and see how our best models from each model family perform on the test set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Capturing best random forest model</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>rf_best_params<span class="ot">&lt;-</span><span class="fu">select_best</span>(rf_fit, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing hyperparameter values</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>rf_best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
   mtry .config         
  &lt;int&gt; &lt;chr&gt;           
1    13 pre0_mod13_post0</code></pre>
</div>
</div>
<p>The “best” model randomly selects 12 predictors from the 13 total predictors.</p>
</section>
<section id="test-set-performance" class="level3">
<h3 class="anchored" data-anchor-id="test-set-performance">Test Set Performance</h3>
<p>Now that we have tuned each model type, we will fit the best models to the full training set and test on the test set. This will allow us to select a final model.</p>
<p>First, we will fit the LASSO model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting LASSO hyperparameter values to those selected via CV</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>lasso_final_wkf<span class="ot">&lt;-</span>lasso_wkf <span class="sc">|&gt;</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lasso_best_params)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting final model to the full training set and testing on original test set</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>lasso_final_fit<span class="ot">&lt;-</span>lasso_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(bike_share_split, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Second, we will fit the regression tree model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting regression tree hyperparameter values to those selected via CV</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>tree_final_wkf<span class="ot">&lt;-</span>tree_wkf <span class="sc">|&gt;</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(tree_best_params)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting final model to the full training set and testing on original test set</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>tree_final_fit<span class="ot">&lt;-</span>tree_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(bike_share_split, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Third, we will fit the bagged tree model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting seed for reproducibility when we rerun this chunk</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting bagged tree hyperparameter values to those selected via CV</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>bag_final_wkf<span class="ot">&lt;-</span>bag_wkf <span class="sc">|&gt;</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(bag_best_params)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting final model to the full training set and testing on original test set</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>bag_final_fit<span class="ot">&lt;-</span>bag_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(bike_share_split, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we will fit the random forest model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting seed for reproducibility when we rerun this chunk</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting rf hyperparameter values to those selected via CV</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>rf_final_wkf<span class="ot">&lt;-</span>rf_wkf <span class="sc">|&gt;</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(rf_best_params)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting final model to the full training set and testing on original test set</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>rf_final_fit<span class="ot">&lt;-</span>rf_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(bike_share_split, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s print the test RMSE and mean absolute error (MAE) to see which model predicted best on the test set. Note that we are including the best MLR model in this table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing RMSE and MAE for the best models of each class</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(final_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"MLR"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()),</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>      lasso_final_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"LASSO"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()),</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>      tree_final_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Reg Tree"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()),</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>      bag_final_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Bagged Tree"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()),</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>      rf_final_fit <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"Random Forest"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(model, <span class="fu">everything</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   model         .metric .estimator .estimate .config        
   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
 1 MLR           rmse    standard    2963.439 pre0_mod0_post0
 2 MLR           mae     standard    2181.411 pre0_mod0_post0
 3 LASSO         rmse    standard    3553.590 pre0_mod0_post0
 4 LASSO         mae     standard    2808.288 pre0_mod0_post0
 5 Reg Tree      rmse    standard    3731.833 pre0_mod0_post0
 6 Reg Tree      mae     standard    2689.069 pre0_mod0_post0
 7 Bagged Tree   rmse    standard    2884.980 pre0_mod0_post0
 8 Bagged Tree   mae     standard    2157.208 pre0_mod0_post0
 9 Random Forest rmse    standard    2880.980 pre0_mod0_post0
10 Random Forest mae     standard    2116.634 pre0_mod0_post0</code></pre>
</div>
</div>
<p>The random forest model predicts daily bike rentals best. There must be some complex non-linear relationships between rentals and the predictors!</p>
</section>
<section id="fit-summaries" class="level3">
<h3 class="anchored" data-anchor-id="fit-summaries">Fit Summaries</h3>
<p>We have already summarized the fit of the MLR model above by printing the coefficients table. Let’s summarize the fits of the other “best” models in this subsection.</p>
<p>To start, we can produce the coefficients table for the best-performing LASSO model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting fit summary</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>lasso_final_fit <span class="sc">|&gt;</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")

Warning: 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">penalty</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">20297.4316</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="even">
<td style="text-align: left;">snowfall</td>
<td style="text-align: right;">-365.8258</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rainfall</td>
<td style="text-align: right;">-1692.8626</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="even">
<td style="text-align: left;">temperature</td>
<td style="text-align: right;">0.0000</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">humidity</td>
<td style="text-align: right;">-1200.1146</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="even">
<td style="text-align: left;">wind_speed</td>
<td style="text-align: right;">-610.0563</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">visibility</td>
<td style="text-align: right;">-121.8673</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="even">
<td style="text-align: left;">dew_point</td>
<td style="text-align: right;">4213.6689</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">radiation</td>
<td style="text-align: right;">4046.7767</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="even">
<td style="text-align: left;">season_Spring</td>
<td style="text-align: right;">-4772.8353</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">season_Summer</td>
<td style="text-align: right;">-3470.6032</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="even">
<td style="text-align: left;">season_Winter</td>
<td style="text-align: right;">-8259.1627</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">holiday_No.Holiday</td>
<td style="text-align: right;">2635.4347</td>
<td style="text-align: right;">3.511192</td>
</tr>
<tr class="even">
<td style="text-align: left;">weekend_yes</td>
<td style="text-align: right;">-2623.7216</td>
<td style="text-align: right;">3.511192</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Interestingly, it seems the only coefficient shrunken all the way to 0 is temperature, which I would not have expected. That said, temperature is correlated with several other predictors.</p>
<p>Now let’s extract the final regression tree fit to the full dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting final tree fit</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>tree_final_fit <span class="sc">|&gt;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>(<span class="at">roundint =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Homework-9_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Maybe the most intriguing fact is that the tree’s first split is based on temperature, the same variable our final LASSO fit excluded.</p>
<p>Let’s plot the variable important metrics from the final bagged tree model to see what role temperature played across the bagged trees.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extracting fit information for bagged tree</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>bag_final_fit_metrics<span class="ot">&lt;-</span><span class="fu">extract_fit_engine</span>(bag_final_fit)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating plot of variable importance metrics</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>bag_final_fit_metrics<span class="sc">$</span>imp <span class="sc">|&gt;</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">factor</span>(term, <span class="at">levels=</span>term)) <span class="sc">|&gt;</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Important for Bagged Tree Model"</span>,<span class="at">y =</span> <span class="st">"Variable Importance"</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Homework-9_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As the importance values are based on reductions in the sum of squared errors and the scale of our response is relatively highly, tens of thousands of rentals per day, our variable importance metrics are massive. However, this is not of particular importance. What’s important is the relative importance levels. Note that temperature has the largest value, indicating it directly contributes the most to our predictive accuracy. This aligns with our basic regression tree model and contrasts with our final LASSO model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating variable importance metrics for random forest</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>rf_final_fit <span class="sc">|&gt;</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">13</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Variable Important for Random Forest Model"</span>, <span class="at">y =</span> <span class="st">"Variable Importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Homework-9_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In general, these variable importance metrics are similar to those of the bagged tree model. However, there are some notable differences. For example, <code>radiation</code> has the second-highest important score in the final random forest model fit to the entire training set, while it only has the fourth-highest score in the bagged tree model.</p>
</section>
<section id="fitting-our-final-model-to-the-full-dataset" class="level3">
<h3 class="anchored" data-anchor-id="fitting-our-final-model-to-the-full-dataset">Fitting our Final Model to the Full Dataset</h3>
<p>If we want to deploy our best model across all classes for future predictions, we want to refit it to the entire dataset to ensure we are predicting based on all available information. As the best random forest model produced the lowest RMSE and MAE when fit to the full training set and tested on the full test set, we declared it our best overall model. Thus, that is the model we will fit to the full dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fitting model to the full dataset</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>final_model<span class="ot">&lt;-</span> rf_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(bike_share_data)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Printing final model information</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
5 Recipe Steps

• step_date()
• step_mutate()
• step_rm()
• step_normalize()
• step_dummy()

── Model ───────────────────────────────────────────────────────────────────────
Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~13L,      x), num.trees = ~2000, min.node.size = min_rows(~5, x), importance = ~"impurity",      num.threads = 1, verbose = FALSE, seed = sample.int(10^5,          1)) 

Type:                             Regression 
Number of trees:                  2000 
Sample size:                      353 
Number of independent variables:  13 
Mtry:                             13 
Target node size:                 5 
Variable importance mode:         impurity 
Splitrule:                        variance 
OOB prediction error (MSE):       7589054 
R squared (OOB):                  0.9231467 </code></pre>
</div>
</div>
<p>Now we are ready to deploy our model!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>